## 指令格式

### 基本格式

一条指令就是机器语言的一个语句，是一组有意义的二进制代码。一条指令通常包括**操作码**字段和**地址码**字段两个部分。

操作码指出一条指令中该指令应该执行什么性质的操作以及具有何种功能。例如指出时算术加运算还是减运算。

地址码给出被操作信息的地址。

指令的长度指的是一条指令中所包含的**二进制代码的位数**。指令长度取决于操作码的长度、操作数地址码的长度以及操作数地址的个数。指令长度与机器字长没有固定关系，通常把指令长度等于机器字长的指令称为**单字长指令**，等于半个机器字长的指令称为**半字长指令**。

一个指令系统中，如果所有指令的长度都相等，则称为**定长指令字结构**，定字长指令的执行速度快、控制简单。各指令长度随功能而异，称为**变长指令字结构**。

根据指令中**操作数地址数量**的不同，可以将指令分为：

**零地址指令**

只给出操作码OP，没有显式地址。



**一地址指令**





**二地址指令**





**三地址指令**





**四地址指令**



### 定长操作码指令格式

在指令字的最高位部分分配固定的若干位（定长）表示操作码。一般n位操作码字段的指令系统最大能表示$2^n$条指令。

### 扩展操作码指令格式

为了在指令字长有限的前提下保持比较丰富的指令种类，可采取**可变长操作码**，即全部指令的操作码字段**位数不固定**，且分散地放在指令字的不同位置上。

最常见的变长操作码方法是扩展操作码，它使操作码的长度随地址码的减少而增加，不同地址数的指令有不同长度的操作码。

注意：

* 不允许短码是长码的前缀
* 各指令的操作码不能重复

通常对使用频率较高的指令分配较短的操作码，对使用频率较低的指令分配较长的操作码。

### 指令的操作类型

* 数据传送
* 算术和逻辑运算
* 移位操作
* 转移操作
* 输入输出操作





## 指令的寻址方式

寻找指令或操作数的有效地址的方式，即确定本条指令的数据地址以及下一条待执行指令的地址的方式。

寻址方式分为：指令寻址和数据寻址两大类。

### 指令寻址和数据寻址





### 常见寻址方式

**隐含寻址**

**不明显地给出**操作数的地址，而在指令中隐含操作数的地址。例如单地址的指令格式规定累加器（ACC）作为第二操作数的地址。

优点：有利于**缩短指令字长**；缺点：需要增加存储器操作数或隐含地址的硬件。



**立即数寻址**

地址字段为**操作数本身**而不是地址，又称为立即数。数据采用补码存放。

优点：不用访问主存，指令执行时间段；缺点：**A的位数**限制了立即数的**范围**。

**直接寻址**

指令字中的形式地址A为操作数的**真实地址EA**，即EA=A

优点：简单，指令执行阶段**仅访问一次主存**，不需要专门计算操作数的地址；缺点：**A的位数**决定了该操作数的**寻址范围**。

**间接寻址**

指令地址字段给出的地址不是操作数的真正地址，而是操作数有效地址所在的存储单元的地址，即**操作数地址的地址**。

间接寻址可以是一次间接寻址，也可以是多次。

优点：可以**扩大寻址范围**，便于编程（可方便地完成子程序的返回）；缺点：指令在执行阶段要**多次访存**。

**寄存器寻址**

直接给出操作数所在的**寄存器的编号**。

该寻址方式在指令执行期间**不访问主存**，只访问寄存器，速度较快，但寄存器价格昂贵，计算机中的寄存器个数有限。

**寄存器间接寻址**

寄存器中给出操作数**所在主存单元的地址**。

与一般间接寻址相比速度更快，但是指令执行阶段需要访问主存。

**相对寻址**

把**程序计数器PC的内容**加上指令格式中的**形式地址A**形成操作数的有效地址。即EA=(PC)+A

优点：操作数的地址不是固定的，随PC值的变化而变化，且与指令地址之间总相差一个固定值，便于**程序浮动**。广泛用于转移指令。

**基址寻址**

将CPU中**基址寄存器中的内容**加上指令格式中的**形式地址A**形成的操作数的有效地址。即EA=(BR)+A

基址寄存器是面向**操作系统**的，主要用于为多道程序或数据分配存储空间。基址寄存器的值由操作系统确定，程序执行过程中其值不可以改变，而指令字中的**A可以改变**。

优点是可以**扩大寻址范围**（基址寄存器的位数大于形式地址A的位数）；用户不必考虑自己的程序存于主存的哪个空间区域，有利于**多道程序设计**。并可用于编制浮动程序，但偏移量的位数较短。

**变址寻址**

有效地址为指令字中的**形式地址A**与**变址寄存器IX中的内容**的和。

变址寄存器是面向**用户**的。变址寄存器中的内容可以由用户改变，并且程序执行过程中其值可以改变，而指令字中的**A不可以该变**。

变址寻址的优点是可扩大寻址范围；在**数组**处理过程中可以设定A为数组首地址，不断改变变址寄存器IX的内容，可以容易地形成数据中任意数据的地址，适合编制循环程序。偏移量的位数足以表示整个存储空间。

**堆栈寻址**

堆栈是存储器中一块特定的、按LIFO后进先出原则管理的存储区，该存储区中读写地址是使用**堆栈指针SP**寄存器给出的。

堆栈可分为硬堆栈和软堆栈。

栈指针指向栈顶的空单元。

### X86汇编指令入门

**相关寄存器**

8个32位通用寄存器，除了堆栈基指针EBP和堆栈顶指针ESP外其他几个寄存器的用途是比较任意的。





**寻址模式和内存分配**





**常用指令**

汇编指令可分为数据传送指令、逻辑计算指令和控制流指令。

* 数据传送指令
  * mov
  * push
  * pop
* 算术和逻辑运算指令
  * add/sub
  * inc/dec
  * imul
  * idiv
  * and/or/xor
  * not
  * neg
  * shl/shr
* 控制流指令
  * jmp
  * j(condition)
    * je
    * jne
    * jz
    * ...
  * cmp
  * call/ret：分别实现了子程序（过程、函数等）的调用以及返回。











## CISC和RISC

复杂指令系统计算机(CISC)：增强原有指令功能，设置更为复杂的新指令，实现软件功能的硬件化。例如X86架构计算机。

精简指令系统计算机(RISC)：减少指令种类，简化指令功能，提高指令的执行速度。例如ARM、MIPS架构的计算机。

### CISC

VLSI技术。



### RISC

精简指令系统计算机。要求指令系统简化，尽量使用寄存器-寄存器操作指令，指令格式力求一致。

主要特点：

见书。



### 二者的比较







