## I/O管理概述

### I/O设备

I/O设备按照使用特性可以分为以下类型：

* 人机交互类外部设备
* 存储设备
* 网络通信设备

按照传输速率可分为：低速、中速、高速设备

按信息交换类型的单位分为：块设备、字符设备

### I/O控制方式

程序直接控制方式、中断驱动方式、DMA方式、通道控制方式。

该部分内容详见组成原理部分。

### I/O子系统的层次结构

整个I/O系统可以视为具有4个层次的系统结构，各层次及其功能如下：

**用户层I/O软件**

实现与用户交互的接口，用户可以直接调用在用户层提供的、与I/O操作有关的函数，对设备进行操作。



**设备独立性软件**

用于实现用户程序与设备驱动器的统一接口、设备命令、设备保护以及设备的分配与释放。

设备独立性也称设备无关性，使得应用程序独立于具体使用的物理设备。为实现独立性而引入**逻辑设备**和**物理设备**这两个概念。

应用程序中，使用逻辑设备名来请求使用某类设备；系统实际执行时，必须将逻辑设备名映射成物理设备名使用。

设备独立心性软件的主要功能可以分为：

* 执行所有设备的公有操作。
* 向用户层（或文件曾）提供统一接口。

**设备驱动程序**





**中断处理程序**

用于保存被中断进程的CPU环境，转入相应的中断处理程序进行处理，处理完并恢复被中断进程的现场后，返回到被中断进程。

**硬件设备**

包括一个机械部件（设备本身）和一个电子部件（又称适配器，即一块插入主板的印刷电路板）





## I/O核心子系统

### 概述

I/O设备种类繁多，功能、速度差异大，需要多种方法来进行设备控制。这些方法共同组成了操作系统内核的I/O子系统，它将内核的其他方面从繁重的I/O设备管理中解放出来。该子系统主要有I/O调度、缓冲与高速缓存



### I/O调度概念

确定一个好的顺序来执行这些I/O请求。应用程序发布的系统调用顺序不一定是最佳选择，需要I/O调度来改善系统整体性能，使进程之间公平地共享设备访问，减少I/O完成所需要的平均等待时间。

操作系统为每个设备维护一个请求队列来实现调度。当一个应用程序执行阻塞I/O系统时，该请求就加到相应设备的队列上。I/O调度会重新安排队列顺序以改善系统总体效率和应用程序的平均响应时间。

### 高速缓存与缓冲区

**磁盘高速缓存**

利用内存中的存储空间来暂存从磁盘中读出的一系列盘块中的信息。**逻辑上**属于**磁盘**，**物理上**则驻留在**内存**中的盘块。

高速缓存在内存中分为两种形式：一种是在内存中单独开辟一个存储空间作为磁盘高速缓存，大小固定；另一种是把未利用的内存空间作为一个缓冲池，供请求分页系统和磁盘I/O时共享。

**缓冲区Buffer**

设备管理子系统引入缓冲区的主要目的是：

* 缓和CPU与I/O设备间速度不匹配的矛盾
* 减少对CPU的中断频率，放宽对CPU中断先攻时间的限制
* 解决基本数据单元大小（数据粒度）不匹配的问题
* 提高CPU和I/O设备之间的并行性

实现方法为：

* 采用硬件缓冲器，成本较高
* 采用缓冲区（位于内存区域）

根据系统设置缓冲器的个数，缓冲技术可以分为：

* 单缓冲
* 双缓冲：提高了处理机和输入设备的并行操作的程度
* 循环缓冲
* 缓冲池



### 设备分配与回收

**设备分配概述**

根据用户的I/O请求分配所需的设备，分配的总原则是充分发挥设备的使用效率。

* 独占式使用设备
* 分时式共享使用设备
* 以SPOOLing方式使用外部设备

**设备分配的数据结构**





**设备分配的策略**





**设别分配的安全性**







### 假脱机技术

为了缓和CPU的高速性与I/O设备低速性之间的矛盾，引入了脱机输入/输出技术。该技术利用专门的外围控制机，将低速I/O设备上的数据传送到高速磁盘上，或者相反。

**输入井和输出井**

是指在磁盘上开辟出的两个存储区域。二者用于模拟脱机输入/输出时的磁盘。

**输入缓冲区和输出缓冲区**

是在内存中开辟的两个缓冲区。输入缓冲区用于暂存由输入设备送来的数据，以后再传送到输入经。输出缓冲区用于暂存从输出井送来的数据，以后再传送到输出设备。

**输入进程和输出进程**

















