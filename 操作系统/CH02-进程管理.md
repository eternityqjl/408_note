## 进程与线程

### 进程的概念和特征

**概念**

多道程序环境下，引入进程的概念，以便更好地描述和控制程序的并发执行，实现操作系统的**并发性和共享性**。

为了使得参与并发执行的程序(包含数据)能够独立地运行，必须为之配置一个专门的数据结构，称为**进程控制块(PCB)**。系统利用PCB来描述进程的基本情况和运行状态，进而控制和管理进程。相应地，由**程序段、相关数据段和PCB**三部分构成了**进程映像**（实体）。创建进程实质上是创建**进程映像中的PCB**，撤销进程实际上是撤销进程的PCB。

PCB是**进程存在**的唯一标志。

**特征**

* 动态性：进程是程序的依次执行，它有着创建、活动、暂停、终止等过程，具有一定的**生命周期**。
* 并发性：多个进程实体同时存在于**内存**中。
* 独立性：进程实体是一个能独立运行、独立获得资源、独立接受调度的基本单位
* 异步性：进程之间相互制约，按照各自独立的、不可预知的速度向前推进；异步性会导致执行结果不可再现，因此在操作系统中必须配置相应的同步机制。
* 结构性：进程实体由程序段、数据段、PCB三部分组成。

### 进程的状态与转换

* **运行态**：进程正在处理机上运行。单处理机环境下每个时刻最多只有一个进程处于运行态。
* **就绪态**：进程获得除了处理机外的一切资源，一旦获得处理机资源，就可以立即运行。系统中可能有多个处于就绪态的进程，它们排成一个队列，称为就绪队列。
* **阻塞态**（等待态）：进程正在等待某一时间而暂停，可能是I/O完成或等待某资源成为可用。
* 创建态：进程正在被创建，尚未转到就绪态。创建过程：首先申请一个PCB，并向PCB中写入一些控制和管理进程的信息，然后系统为进程分配所需的资源，最后把进程转入就绪态。
* 结束态：进程正从系统中消失，可能是进程正常结束或其他原因中断退出运行。

整个系统的3种基本状态之间的转换：

* 就绪态$\rightarrow$运行态
* 运行态$\rightarrow$就绪态：处于运行态的程序在时间片用完后不得不让出处理机，从而从运行态转为就绪态
* 运行态$\rightarrow$阻塞态：进程请求某一资源的使用和分配或登台某一之间的发生时，就从运行态转换为阻塞态
* 阻塞态$\rightarrow$就绪态：进程等待的事件到来时，如I/O操作结束或中断结束时，中断处理程序必须把相应的进程的状态转换为就绪态

### 进程控制

对系统中所有进程实施有效的管理，具有创建新进程、撤销已有进程、实现进程状态转换等功能。操作系统中一般把进程控制用的程序段称为**原语**。原语执行期间不允许中断，是一个不可分割的单位。

**进程的创建**

允许一个进程创建另一个进程，创建者称为父进程，被创建的进程称为子进程，子进程可以继承父进程拥有的资源。

操作系统创建一个新进程（原语）的过程如下：

* 为新进程分配一个唯一的进程标识号（PID），并申请一个空白的PCB。
* 为进程分配资源，即必要的内存空间；若资源不足，并不是创建失败，而是处于阻塞态
* 初始化PCB，主要包括初始化标志信息、处理机状态信息和控制信息、进程的优先级
* 若就绪队列能够接纳新进程，则将新进程插入就绪队列



### 进程的组织





### 进程的通信





### 线程概念和多线程模型

**线程基本概念**
引入线程的目的是减小程序在并发执行时所付出的开销，提高操作系统的并发性能。

线程的直接理解就是轻量级进程，它是一个**基本的CPU执行单元**，也是程序执行流的最小单元，由线程ID、程序计数器、寄存器集合和堆栈组成。





## 处理机调度

### 调度的概念

**概念**

进程数量往往多于处理机的个数，因此**进程竞争**处理机在所难免。处理机调度是按照一定的算法（公平、高效），选择一个进程并将处理机分配给它运行，实现进程并发地执行。

处理机调度机制是多道程序操作系统的基础，是操作系统设计的核心问题。

**调度的层次**

* 作业调度：又称高级调度，按照一定的原则从外存上处于后备状态的作业中挑选一个或多个，给它们分配内存、输入/输出设备等必要资源，并建立相应的进程，使它们获得竞争处理机的权利。简而言之就是内存与辅存之间的调度。
* 中级调度：又称内存调度，作用是提高内存利用率和系统吞吐量。



### 调度的时机、切换与过程



### 进程调度方式

调度方式指的是当某个进程正在处理机上执行时，有某个优先权更高的进程进入就绪队列，此时应该如何分配处理机的问题。通常由一下两种方式：

* 非剥夺调度方式：
* 剥夺调度方式：立即暂停正在执行的进程，将处理及分配给这个优先级更高的进程



### 调度的基本准则

为了比较处理机调度算法的性能，提出了以下一些评价准则：

* CPU利用率
* 系统吞吐量
* 周转时间
* 等待时间：进程处于等处理机状态的时间之和，等待时间越长，用户满意度越低
* 响应时间

### 典型的调度算法

**先来先服务(FCFS)调度算法**





**短作业优先(SJF)调度算法**





**优先级调度算法**





**高响应比优先调度算法**





**时间片轮转调度算法**







## 进程同步

### 基本概念

用来协调不同进程之间的相互制约关系。

**临界资源**

系统中的许多资源只能为一个进程所用，我们将依次仅允许一个进程使用的资源称为临界资源。许多物理设备都属于临界资源。

对于临界资源的访问，必须**互斥**地进行，在每个进程中，访问临界资源的那段代码被称为**临界区**。我们可以把临界资源的访问过程分为4个部分：

* 进入区：
* 临界区
* 退出区
* 剩余区



**同步**

同步也称直接制约关系，指为了完成某种任务而建立的两个多多个进程，这些进程因为需要在某些位置上协调它们的工作次序而等待、传递信息所产生的制约关系。进程间的直接制约关系源于它们之间的合作。



**互斥**

互斥也称间接制约关系。当一个进程进入临界区使用临界资源时，另一个进程必须等待，当占用资源的进程退出临界后，另一个进程才允许访问此临界资源。

### 实现临界区互斥的基本方法







### 信号量





### 管程









## 死锁

### 概念

**定义**

死锁是多个进程因竞争资源而造成的一种僵局（互相等待），若无外力作用，这些进程都将无法向前推进。

**产生的原因**

* 系统资源的竞争：通常系统中拥有的**不可剥夺资源**数量不足以满足多个进程运行的需要，使得进程在运行过程中因为资源争夺而陷入僵局。
* 进程推进顺序非法：
* 死锁产生的必要条件（以下4个要同时满足才能产生死锁）
  * 互斥条件：
  * 不剥夺条件：
  * 请求并保持条件：
  * 循环等待条件：



### 处理策略







### 死锁预防





### 死锁避免







### 死锁检测和解除

