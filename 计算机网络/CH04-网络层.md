## 网络层的功能







## 路由算法









## IPv4

### IPv4分组

**IPv4分组格式**







**IP数据报分片**

当IP数据报的总长度大于链路层MTU时，就需要将IP数据报中的数据分装在两个或多个较小的IP数据报中，这些较小的数据报称为片。

片在目的地网络层被重新组装。目的主机使用IP首部中的**标识、标志和片偏移**字段完成对片的重组。



### IPv4地址与NAT



私有IP地址网段：

* A类：1个，10.0.0.0~10.255.255.255
* B类：16个，172.16.0.0~172.31.255.255
* C类：256个，192.168.0.0~192.168.255.255





### 子网划分与子网掩码、CIDR





### ARP、DHCP与ICMP

**地址解析协议ARP**

完成从IP地址到MAC地址的映射。每台主机上都有一个ARP高速缓存，用来存放局域网内各主机和路由器到MAC地址的映射表，称为ARP表。

ARP表工作在网络层。





**动态主机配置协议DHCP**

DHCP是应用层协议，基于UDP。

该协议用于给主机动态地分配IP地址，提供了即插即用的联网机制。

工作原理：使用客户/服务器模式。需要IP的主机在启用时向DHCP服务器广播发送发现报文，这时主机成为DHCP客户。本地网络上所有主机都能收到此广播报文，但只有DHCP服务器才能回答该报文。DHCP服务器先从其数据库中找到该计算机的配置信息，若找到，则返回找到的信息。若找不到则从IP池中去一个地址分配给该计算机。







**网际控制报文协议ICMP**

在网络层采用该协议来让主机或路由器**报告差错和异常情况**。

ICMP报文作为IP层数据报的数据，加上数据报的首部，组成IP数据报发送出去。

* ICMP差错报文（用于目的主机或到目的主机路径上的路由器向源主机报告差错和异常）
  * 终点不可达
  * 源点抑制
  * 时间超过
  * 参数问题
  * 改变路由（重定向）

* ICMP询问报文
  * 回送请求和回答报文
  * 时间戳请求和回答报文
  * 地址掩码请求和回答报文
  * 路由器询问和通告报文

ICMP最常用的应用是分组网间探测PING和Traceroute。















## IPv6







## 路由协议

### 自治系统

自治系统（AS）：单一技术管理下的一组路由器。这些路由器使用同一种AS内部的路由选择协议。

一个自治系统内的所有网络都由同一个单位管辖，一个自治系统内的所有路由器都是连通的。



### 域内路由与域间路由

**内部网关协议IGP**

在一个自治系统内部使用的路由选择协议，使用最多的是RIP和OSPF。

**外部网关协议EGP**

源站和目的站处于不同自治系统中时使用一种协议将信息从一个自治系统传送到另一个自治系统。使用最多的是BGP-4.

### 路由信息协议（RIP）

分布式的基于**距离向量**的路由选择协议。





### 开放最短路径优先（OSPF）协议

使用分布式链路状态路由算法。

OSPF向本自治系统内所有路由器发送信息，使用的是泛洪法。



### 边界网关协议（BGP）









## IP组播

### 组播概念





### IP组播地址





### IGMP与组播路由算法







## 移动IP







## 网络层设备

